<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.98.0"><title>Traffic mirroring: test your APIs automatically, without writing tests - KrakenD API Gateway</title><meta name=description content="Use traffic mirroring to shadow testing new API releases with real traffic looking for performance or feature regressions."><meta itemprop=name content="Traffic mirroring: test your APIs automatically, without writing tests - KrakenD API Gateway"><meta itemprop=description content="Use traffic mirroring to shadow testing new API releases with real traffic looking for performance or feature regressions."><meta itemprop=image content="https://raw.githubusercontent.com/opendiffy/diffy/master/images/diffy_topology.png"><meta property="og:title" content="Traffic mirroring: test your APIs automatically, without writing tests"><meta property="og:description" content="Use traffic mirroring to shadow testing new API releases with real traffic looking for performance or feature regressions."><meta property="og:type" content="article"><meta property="og:url" content="https://www.krakend.io/blog/krakend-shadow-testing/"><meta property="og:image" content="https://raw.githubusercontent.com/opendiffy/diffy/master/images/diffy_topology.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-07-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-27T00:00:00+00:00"><meta property="og:site_name" content="KrakenD - Open source API Gateway"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raw.githubusercontent.com/opendiffy/diffy/master/images/diffy_topology.png"><meta name=twitter:title content="Traffic mirroring: test your APIs automatically, without writing tests"><meta name=twitter:description content="Use traffic mirroring to shadow testing new API releases with real traffic looking for performance or feature regressions."><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name=viewport><link rel=stylesheet href="https://www.krakend.io/css/bundle.min.9ac7af116157686c1234fdbd955c7b29b3ccef1ba850d36786908a1283e62111.css"><link rel=icon type=image/png href=/favicon/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=/favicon/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicon/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicon/favicon-128.png sizes=128x128><script async src="https://www.googletagmanager.com/gtag/js?id=G-9GKZST2CDC"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9GKZST2CDC",{anonymize_ip:!1})}</script></head><body class=krakend><p class="flex h-10 items-center justify-center bg-denim-500 px-4 text-sm font-medium text-white sm:px-6 lg:px-8"><span class="inline-flex items-center rounded-full bg-denim-100 px-2.5 py-0.5 mr-2 text-xs font-medium text-denim-800">News</span>
<a title="KrakenD 2.3.2 (patch version) released" href=https://www.krakend.io/blog/krakend-2.3.2-release-notes/ class="text-white text-bold">KrakenD 2.3.2 (patch version) released</a></p><div class=relative><nav class="max-w-7xl mx-auto lg:flex py-6 items-center justify-between"><div class="ml-4 xl:ml-0"><a href=/ title=Home><img src=/images/logo-krakend.svg alt="KrakenD Logo" width=180></a></div><div class="hidden ml-12 mr-4 xl:mr-0 lg:flex-grow lg:flex lg:justify-between lg:space-x-8" id=navbarMenu><ul class="lg:flex lg:space-x-8 font-medium xl:text-lg whitespace-nowrap z-50"><li><a class="hover:text-denim-600 text-gray-700" href=/open-source/>Open Source</a></li><li><a class="hover:text-denim-600 text-gray-700" href=/enterprise/>Enterprise</a></li><li><a class="hover:text-denim-600 text-gray-700" href=https://www.krakend.io/case-study/>Case studies</a></li><li><a class="hover:text-denim-600 text-gray-700" href=/docs/overview/>Docs</a></li><li class="nav-item dropdown"><a class="hover:text-denim-600 text-gray-700" href=# class="nav-link dropdown-toggle" data-toggle=dropdown>Resources<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></a><ul class="hidden absolute ml-4 divide-y rounded-lg shadow dropdown-menu bg-white"><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=/features/>Open Source VS Enterprise</a></li><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=/blog/>Blog</a></li><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=/support/>Support</a></li><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=https://designer.krakend.io>Designer (Config UI)</a></li><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=/partners/>Partners</a></li><li class="py-1 px-6"><a class="hover:text-denim-600 text-gray-700" href=/team/>About us</a></li></ul></li></ul><ul class="hidden lg:flex lg:space-x-4 text-sm font-medium whitespace-nowrap"><li><a class="text-gray-700 hover:text-denim-600" href=/download/><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414.0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414.0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>Downloads</a></li><li><a class="btn -mt-3 bg-denim-800 hover:bg-denim-500 text-white" href=/enterprise/#contact-sales><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5A2 2 0 003 7v12a2 2 0 002 2z"/></svg>Request a Demo</a></li></ul></div><button class="print:hidden absolute right-4 top-2 lg:hidden p-3 rounded-lg border border-gray-100 navbar-toggler" type=button data-toggle=collapse data-target=#navbarMenu aria-controls=navbarMenu aria-expanded=false aria-label="Toggle navigation"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button></nav></div><div class=border-t><div class="grid grid-cols-1 md:grid-cols-5 gap-x-8 py-6 max-w-7xl mx-auto"><div class="print:hidden order-last md:order-first"><div class=p-4><h4 class="uppercase font-medium text-gray-400 text-xs mb-2">Blog categories</h4><ul class="px-6 space-y-2 text-sm"><li class=nav-item><a class=nav-link href=/blog/>All categories</a></li></li><li class=nav-item><a href=/categories/announcements/ class=nav-link>announcements</a></li><li class=nav-item><a href=/categories/api-gateway/ class=nav-link>api-gateway</a></li><li class=nav-item><a href=/categories/api2html/ class=nav-link>api2html</a></li><li class=nav-item><a href=/categories/configuration/ class=nav-link>configuration</a></li><li class=nav-item><a href=/categories/devops/ class=nav-link>devops</a></li><li class=nav-item><a href=/categories/docker/ class=nav-link>docker</a></li><li class=nav-item><a href=/categories/enterprise/ class=nav-link>enterprise</a></li><li class=nav-item><a href=/categories/krakend/ class=nav-link>krakend</a></li><li class=nav-item><a href=/categories/kubernetes/ class=nav-link>kubernetes</a></li><li class=nav-item><a href=/categories/reflex/ class=nav-link>reflex</a></li></ul></div><div class=p-4><h4 class="uppercase font-medium text-gray-400 text-xs mb-2">Tags</h4><ul class="px-6 space-y-2 text-sm"><li class=nav-item><a class=nav-link href=/tags/open-source/>open-source</a></li><li class=nav-item><a class=nav-link href=/tags/release-notes/>release-notes</a></li><li class=nav-item><a class=nav-link href=/tags/how-to/>how-to</a></li><li class=nav-item><a class=nav-link href=/tags/enterprise/>enterprise</a></li><li class=nav-item><a class=nav-link href=/tags/company/>company</a></li><li class=nav-item><a class=nav-link href=/tags/golang/>golang</a></li><li class=nav-item><a class=nav-link href=/tags/security/>security</a></li><li class=nav-item><a class=nav-link href=/tags/docker/>docker</a></li><li class=nav-item><a class=nav-link href=/tags/press-release/>press-release</a></li><li class=nav-item><a class=nav-link href=/tags/api-management/>api-management</a></li><li class=nav-item><a class=nav-link href=/tags/cloud/>cloud</a></li><li class=nav-item><a class=nav-link href=/tags/cve/>cve</a></li><li class=nav-item><a class=nav-link href=/tags/devops/>devops</a></li><li class=nav-item><a class=nav-link href=/tags/diy/>diy</a></li><li class=nav-item><a class=nav-link href=/tags/donation/>donation</a></li><li class=nav-item><a class=nav-link href=/tags/edge-computing/>edge-computing</a></li><li class=nav-item><a class=nav-link href=/tags/grpc/>grpc</a></li><li class=nav-item><a class=nav-link href=/tags/ibm/>ibm</a></li><li class=nav-item><a class=nav-link href=/tags/kubernetes/>kubernetes</a></li><li class=nav-item><a class=nav-link href=/tags/packaging/>packaging</a></li><li class=nav-item><a class=nav-link href=/tags/performance/>performance</a></li><li class=nav-item><a class=nav-link href=/tags/tips-and-tricks/>tips-and-tricks</a></li><li class=nav-item><a class=nav-link href=/tags/webassembly/>webassembly</a></li></ul></div><div class=p-4><h4 class="uppercase font-medium text-gray-400 text-xs mb-2">Recent entries</h4><ul class="px-6 space-y-4 text-sm"><li class=nav-item><a class=nav-link href=https://www.krakend.io/blog/krakend-2.3.2-release-notes/>KrakenD 2.3.2 (patch version) released</a></li><li class=nav-item><a class=nav-link href=https://www.krakend.io/blog/krakend-2.3.1-release-notes/>KrakenD 2.3.1 (patch version) released</a></li><li class=nav-item><a class=nav-link href=https://www.krakend.io/blog/krakend-2.3-release-notes/>KrakenD CE v2.3 released!</a></li><li class=nav-item><a class=nav-link href=https://www.krakend.io/blog/krakend-ee-2.2.1-release-notes/>KrakenD Enterprise 2.2.1 (bugfixing) released</a></li><li class=nav-item><a class=nav-link href=https://www.krakend.io/blog/krakend-ee-2.2-release-notes/>KrakenD Enterprise 2.2 released</a></li></ul></div></div><div class=col-span-4><section class=px-4><article class=mb-24><header class="mb-6 lg:mb-12"><h1 class="text-denim-800 text-current text-3xl md:text-5xl">Traffic mirroring: test your APIs automatically, without writing tests</a></h1><div class="my-4 md:flex items-center gap-x-4"><p class=text-denim-800>by <strong>Daniel Lopez</strong></p><p><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline -mt-1 text-gray-500" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M6 2A1 1 0 005 3v1H4A2 2 0 002 6v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3A1 1 0 006 2zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/></svg>Jul 27, 2021</p><div class="text-sm text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline text-gray-500 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3A9 9 0 113 12a9 9 0 0118 0z"/></svg>6 min read</div></div></header><div class="prose prose max-w-full text-lg"><p>Integration and load testing are in the list of best practices in our sector, but synthesizing good inputs for such tests and analyzing the results are usually two hard things to achieve. This post will show you how we suggest our customers set up a shadow testing system with minimal impact on the production environment and proper harness.</p><h2 id=quick-overview>Quick overview</h2><p>As pointed out at <a href=https://cloud.google.com/architecture/application-deployment-and-testing-strategies>https://cloud.google.com/architecture/application-deployment-and-testing-strategies</a></p><blockquote><p><strong>Testing new backend features by using the production load.</strong></p><p>When used with tools such as Diffy, traffic shadowing lets you measure the behavior of your service against live production traffic. This ability enables you to test for errors, exceptions, performance, and result parity between application versions.</p></blockquote><p>In basic terms, our proposal includes two scenarios:</p><ul><li><p>Performance regression testing to answer the question &ldquo;is the new version worst than the current one?&rdquo;</p></li><li><p>Feature regression testing to answer the question &ldquo;does the new version honor the expected behavior defined by the current one?&rdquo;</p></li></ul><p>Both scenarios require <strong>mirroring the incoming traffic</strong>. Still, the second one also requires adding one more piece to the puzzle, which can analyze responses and process the differences between environments/versions.</p><p>Notice: Setting up the network connection from production (where your mirrored traffic comes from) to staging could be tricky, depending on how you deal with domain names and inter-cluster connectivity.</p><h2 id=testing-the-performance>Testing the performance</h2><p>The easiest way to ensure your next release is as performant as the current one is to deploy it in an identical environment as your current version is and clone the incoming traffic.</p><p>At the KrakenD configuration, we can add a mirror backend next to every safe, actual request so that KrakenD can mirror the traffic. The <strong>safe</strong> part in the last statement is vital since KrakenD will reject your endpoint otherwise because the test should not have side effects. The KrakenD documentation site offers a complete description of the <a href=/docs/backends/shadow-backends/>traffic shadowing or mirroring feature</a></p><p>The following configuration snippets will demonstrate the process:</p><h4 id=original>Original</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;/shadow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;backend&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;url_pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;/destinations/1.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;http://service1:8080&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h4 id=final>Final</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;endpoint&#34;</span><span class=p>:</span> <span class=s2>&#34;/shadow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;backend&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;url_pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;/destinations/1.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;http://service1:8080&#34;</span> <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;url_pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;/destinations/1.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=p>[</span> <span class=s2>&#34;http://stg-service1:8080&#34;</span> <span class=p>],</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;extra_config&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;github.com/devopsfaith/krakend/proxy&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&#34;shadow&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>So with this simple change, you can compare the performance metrics of your environments and quickly identify any possible issue.</p><h2 id=feature-regression-test>Feature regression test</h2><p>A lean solution for building such a service is to create a cluster of shadow testing instances for each internal API consumed by the gateway. These shadow testing instances monitor the current and the subsequent release candidate, sending the incoming requests mirrored from the production gateway to the backends deployed at both environments (production and staging) and inspecting the responses, looking for differences to report.</p><p><a href=https://github.com/opendiffy/diffy>Diffy</a> is a fantastic tool that allows teams to harness their API releases without writing a set of synthetic tests just by proxying the incoming traffic to several backends and comparing the responses, looking for noise and differences between them.</p><p><img src=https://raw.githubusercontent.com/opendiffy/diffy/master/images/diffy_topology.png alt="diffy topology"></p><p>An excellent overview and introduction to Diffy is <a href=https://blog.twitter.com/engineering/en_us/a/2015/diffy-testing-services-without-writing-tests>this post</a> from Twitter&rsquo;s engineering team.</p><h2 id=canary-testing-with-the-diffy-service>Canary testing with the Diffy service</h2><p>The proposed flow for all the endpoints consuming resources from the backend <code>service1</code> (notice the naming convention used to identify not-
production-ready environments) is:</p><p><img src=/images/blog/traffic-mirror-workflow.png alt="traffic mirror"></p><p>This is the minimal required Diffy configuration for such environment definition, ignoring the <code>.tld</code> suffix (that we have removed for clarity at the local docker configuration). In this example, the <code>service1</code> name is used as primary and secondary master, delegating the decision to some 3rd party, but they could also be instance hostnames, IP&mldr;</p><pre tabindex=0><code>docker run -ti \
  -p 8880:8880 -p 8881:8881 -p 8888:8888 \
  diffy/diffy \
    -candidate=stg-service1:8080 \
    -master.primary=service1:8080 \
    -master.secondary=service1:8080 \
    -service.protocol=http \
    -serviceName=&#34;Service1&#34; \
    -proxy.port=:8880 \
    -admin.port=:8881 \
    -http.port=:8888 \
    -rootUrl=diffy-service1:8888
    -summary.email=&#39;&#39;
</code></pre><h2 id=mirroring-the-incoming-traffic>Mirroring the incoming traffic</h2><p>With that infrastructure in place, we can make a small change in our KrakenD configurations to send the mirrored traffic to the proper Diffy service instead of sending it directly to the staging environment.</p><p>Again, the following configuration snippets will demonstrate the process:</p><ul><li>sending the mirrored traffic to staging</li></ul><pre tabindex=0><code>    {
      &#34;endpoint&#34;: &#34;/shadow&#34;,
      &#34;backend&#34;: [
        {
          &#34;url_pattern&#34;: &#34;/destinations/1.json&#34;,
          &#34;host&#34;: [ &#34;http://service1:8080&#34; ]
        },
        {
          &#34;url_pattern&#34;: &#34;/destinations/1.json&#34;,
          &#34;host&#34;: [ &#34;http://stg-service1:8080&#34; ],
          &#34;extra_config&#34;: {
              &#34;github.com/devopsfaith/krakend/proxy&#34;: {
                  &#34;shadow&#34;: true
              }
          }
        }
      ]
    }
</code></pre><ul><li>sending the mirrored traffic to Diffy</li></ul><pre tabindex=0><code>    {
      &#34;endpoint&#34;: &#34;/shadow&#34;,
      &#34;backend&#34;: [
        {
          &#34;url_pattern&#34;: &#34;/destinations/1.json&#34;,
          &#34;host&#34;: [ &#34;http://service1:8080&#34; ]
        },
        {
          &#34;url_pattern&#34;: &#34;/destinations/1.json&#34;,
          &#34;host&#34;: [ &#34;http://diffy-service1:8880&#34; ],
          &#34;extra_config&#34;: {
              &#34;github.com/devopsfaith/krakend/proxy&#34;: {
                  &#34;shadow&#34;: true
              }
          }
        }
      ]
    }
</code></pre><p>A complete environment is available at this <a href=https://github.com/kpacha/krakend-diffy>repo</a>.</p><h2 id=validating-the-next-candidate>Validating the next candidate</h2><p>After deploying the new KrakenD configuration, requests will start hitting the Diffy services, and you can start monitoring the results using the Diffy GUI and your tracing backend (check the <a href=/docs/telemetry/>telemetry section</a> for more details).</p><p>In addition to that, if you are using the <a href=https://github.com/openzipkin/b3-propagation>B3 propagation standard</a> in your backends, you will also see the traces at the backend level nested depending on the trace id assigned by the gateway. So you can compare the performance of both versions without delay added by the Diffy proxy.</p><p>The following screenshot shows how the actual client is not affected by the generation of the shadow request to the Diffy instances.</p><p><img src=/images/blog/jaeger-shadow-trace.png alt=jaeger></p><p>Diffy considers differences between responses from primary and secondary upstreams as noise, so it allows you to remove it to see the actual differences between the current version and the one from the staging.</p><p><img src=/images/blog/diffy_noise.png alt=noise></p><p><img src=/images/blog/diffy_no_noise.png alt="no noise"></p><p>You can inspect differences between baselines and candidates in a dedicated pop-up window.</p><p><img src=/images/blog/diffy-report.png alt=differences></p><p>With the differences already highlighted for you</p><p><img src=/images/blog/response-difference.png alt="response difference"></p><p>Diffy is smart enough to know that such difference has no value, and it considers these kinds of scenarios as noise and allows you to ignore them.</p><h2 id=observations>Observations</h2><h3 id=restrictions>Restrictions</h3><p>The feature regression testing system is just limited to check use cases that we don&rsquo;t update frequently. If sending the same request one second after or not could hugely impact the response, then the use case is not a good candidate for the feature regression test. These scenarios also require a longer training time before being able to interpret the deviation of the results.</p><h3 id=impact-on-load>Impact on load</h3><p>It&rsquo;s critical to keep in mind that, by using the Diffy trick, the load of the defined backend endpoints will increase by 200%. Here are some easy options to keep the extra load under control:</p><ol><li><p>set up the shadow traffic feature in a subset of KrakenD instances, so not all the incoming traffic gets mirrored.</p></li><li><p>schedule a couple of blue-green deployments per day, week, or whatever your deployment cycle is, enabling and disabling the shadow backends.</p></li><li><p>switching from pure mirroring (Diffy off) to shadowed harnessing your versions (Diffy on).</p></li><li><p>add a new environment cloned from production with the current version and use it as a source of truth in your Diffy tests, so your production environment doesn&rsquo;t receive the extra load. This option could require a read-only replica of your production databases to keep the source of truth up to date.</p></li></ol><h3 id=privacy-concerns>Privacy concerns</h3><p>One final thought regarding privacy: Diffy will check the processed responses&rsquo; contents and store sensitive data without obfuscating it. Depending on your requirements, maybe you&rsquo;ll need some extra work in that area.</p><h2 id=conclusions>Conclusions</h2><p>We have seen one powerful application of the traffic mirroring feature KrakenD API Gateway offers out-of-the-box: shadow testing your API releases. With minimal changes to the gateway, we can mirror the production traffic to a testing environment where we can evaluate new release candidates in terms of performance and functionality without writing a single synthetic test.</p><p>Start doing your experiments now by downloading the <a href=https://github.com/kpacha/krakend-diffy>source code</a> of these examples.</p><p>Thanks for reading! If you like our product, don&rsquo;t forget to <a href=https://github.com/luraproject/lura/stargazers>star our project</a>!</p><div class="border-t border-gray-200"><p class=text-sm><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline text-gray-500" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414.0l-7-7A.997.997.0 012 10V5a3 3 0 013-3h5c.256.0.512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>Tags:
<a href=/tags/how-to/ title="More posts with tag how-to"><span class="inline-flex items-center rounded-full bg-denim-100 px-2.5 py-0.5 mr-2 text-xs font-medium text-denim-800">how-to</span></a></p></div></div></article></section></div></div></div><div class="print:hidden bg-gradient-to-r from-denim-500 to-denim-800 py-8"><div class="max-w-7xl mx-auto sm:flex sm:space-y-0 space-y-4 text-center sm:text-left items-center justify-between px-8"><div class="flex-none text-xl font-medium text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" viewBox="0 0 20 20" fill="currentcolor"><path d="M2.003 5.884 10 9.882l7.997-3.998A2 2 0 0016 4H4A2 2 0 002.003 5.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>Stay up to date with KrakenD releases and important updates</div><div class=flex-grow><form action="https://krakend.us19.list-manage.com/subscribe/post?u=5cae4bbe9877b1adfe8fe808d&id=e5385eb57b&v_id=4265&f_id=006687e4f0" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate><div style=position:absolute;left:-5000px aria-hidden=true><input type=text name=b_5cae4bbe9877b1adfe8fe808d_e5385eb57b tabindex=-1></div><div class="flex items-center justify-center sm:justify-end"><input type=email name=EMAIL class="block rounded-l px-3 py-1 w-full max-w-xs" id=mce-EMAIL placeholder="email address" required>
<input type=hidden name=tags value=6244009>
<input type=hidden id=gdpr_14365 name=gdpr[14365] value=Y>
<input type=submit class="block bg-denim-500 text-white rounded-r px-3 py-1" value=Subscribe></div></form></div></div></div><footer class="print:hidden bg-gradient-to-r from-denim-900 to-denim-800 py-8 sm:py-18 text-gray-300"><div class="max-w-7xl mx-auto px-4"><div class="lg:grid lg:grid-cols-6 md:grid md:grid-cols-4"><div class="lg:col-span-3 pr-12"><img src=/images/logo-white.png width=353 alt="KrakenD API Gateway"><p class="text-xl my-6 text-denim-300">The <strong>Ultra-High performance</strong> Open Source API Gateway</p><p class="text-sm my-4">KrakenD helps application developers release features quickly by eliminating all the complexities of SOA architectures while offering a unique performance.</p></div><div><h6>Social</h6><ul class="ml-2 my-2"><li><a class=text-denim-300 href=/blog/>Blog</a></li><li><a class=text-denim-300 href=https://medium.com/krakend>Medium</a></li><li><a class=text-denim-300 href=https://twitter.com/krakend_io>Twitter</a></li><li><a class=text-denim-300 href=https://github.com/krakendio>GitHub</a></li><li><a class=text-denim-300 href=https://www.linkedin.com/company/krakend/>LinkedIn</a></li></ul><h6>Experiments</h6><ul class="ml-2 mb-2"><li><a class=text-denim-300 href=https://api2html.com>API2HTML</a></li></ul></div><div><h6>KrakenD</h6><ul class="ml-2 my-2"><li><a class=text-denim-300 href=/open-source/>Open Source</a></li><li><a class=text-denim-300 href=/enterprise/>Enterprise</a></li><li><a class=text-denim-300 href=/case-study/>Case studies</a></li><li><a class=text-denim-300 href=/docs/benchmarks/>Benchmarks</a></li><li><a class=text-denim-300 href=/download/>Download</a></li><li><a class=text-denim-300 href=/team/>Team</a></li></ul></div><div><h6>Support</h6><ul class="ml-2 my-2"><li><a class=text-denim-300 href=/support/>Support channels</a></li><li><a class=text-denim-300 href=/docs/overview/>Documentation</a></li><li><a class=text-denim-300 href=https://github.com/krakendio/krakend-ce target=_blank>Open Source</a></li><li><a class=text-denim-300 href=https://github.com/krakendio/krakend-ce/issues>Report an issue</a></li><li><a class=text-denim-300 href=https://www.krakend.io/security-policy/>Report a vulnerability</a></li></ul></div></div><div class="sm:flex sm:justify-between sm:items:center"><div><strong>Copyright &copy; 2017-2023 KRAKEND S.L.</strong> - <a href=/terms/ class=text-denim-300>Terms</a> - <a href=/privacy-policy/ class=text-denim-300>Privacy Policy</a></div><div class=whitespace-nowrap>Made with&nbsp;
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline text-red-600 animate-pulse" viewBox="0 0 20 20" fill="currentcolor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656.0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/></svg>&nbsp;in Barcelona</div></div></div></footer><div class="print:hidden fixed w-full text-sm bottom-0 bg-white border-t border-gray-400 pea_cook_wrapper pea_cook_bottom z-20"><p class="relative max-w-7xl mx-auto py-4">We use cookies to understand how you use our site and to improve your overall experience. By continuing to use our site, you accept our Privacy Policy.
<a data-toggle=modal data-target=#cookiesConsent class=text-black href=#>More information</a>
<button class="absolute right-0 top-2 p-2 bg-denim-500 rounded-lg text-white ACCEPT_COOKIES">Accept</button></p></div><div class="hidden fixed top-0 left-0 w-full h-full bg-denim-800 bg-opacity-80" id=cookiesConsent tabindex=-1 role=dialog aria-labelledby=cookiesConsentLabel aria-hidden=true><div class="modal-dialog mx-auto top-1/3 max-w-xl bg-white rounded-lg p-12 relative" role=document><div class=modal-content><div class=mb-4><h5 class=font-bold id=cookiesConsentLabel>Cookies</h5><button type=button class="close absolute right-5 top-5 text-xl" data-dismiss=modal aria-label=Close>
<span aria-hidden=true>✖︎</span></button></div><div class=text-sm><p>In order to give you the best experience, we use cookies and similar technologies for performance, analytics and marketing. Want to know more? <a href=/privacy-policy/>Privacy Policy</a></p></div><div class="mt-4 text-center"><button type=button class="py-1 px-3 bg-denim-500 text-white rounded-lg ACCEPT_COOKIES" data-dismiss=modal>
Accept cookies</button></div></div></div></div><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script>
<script src=https://www.krakend.io/main.js></script>
<script>(function(s,o,i,t,n,e){n='',t="https://tracking.g2crowd.com/attribution_tracking/conversions/"+s+".js?p="+encodeURI(o)+"&e="+n,e=document.createElement("script"),e.type="application/javascript",e.async=!0,e.src=t,i.getElementsByTagName("head")[0].appendChild(e)})("1007316",document.location.href,document)</script></body></html>