<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.49" />


    <title>Response manipulation - KrakenD API Gateway</title>
    <meta itemprop="name" content="Response manipulation - KrakenD API Gateway">
    <meta name="twitter:title" content="Response manipulation - KrakenD API Gateway">
    <meta property="og:title" content="Response manipulation - KrakenD API Gateway">

    
    <meta property="description" content="Response manipulation - KrakenD API Gateway">
    <meta itemprop="description" content="Response manipulation - KrakenD API Gateway">
    <meta name="twitter:description" content="Response manipulation - KrakenD API Gateway">
    <meta property="og:description" content="Response manipulation - KrakenD API Gateway">
    

    
    <meta itemprop="image" content="http://www.krakend.io/images/logo.png">
    <meta name="twitter:image:src" content="http://www.krakend.io/images/logo.png">
    <meta property="og:image" content="http://krakend.io/images/logo.png" />
    

    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://www.krakend.io/docs/features/response-manipulation/" />



<meta name="twitter:site" content="@devopsfaith">
<meta name="twitter:creator" content="@devopsfaith">
<meta name="twitter:card" content="summary">


<meta property="og:site_name" content="KrakenD - Ultra-High performance API Gateway with middlewares" />




<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

<link rel="stylesheet" href="https://www.krakend.io/dist/bootstrap/css/bootstrap.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">


<link rel="stylesheet" href="https://www.krakend.io/dist/css/AdminLTE.min.css">
<link rel="stylesheet" href="https://www.krakend.io/dist/css/skin-black-light.min.css">
<link rel="stylesheet" href="https://www.krakend.io/dist/css/custom.css">






</head>
<body class="hold-transition sidebar-mini skin-black-light">
    <div class="wrapper">
            
    <header class="main-header">

        
        <a href="https://www.krakend.io/" class="logo">
            
      <span class="logo-mini">
        <img src="https://www.krakend.io/images/logo-mini.png" alt="">
      </span>
            
            <img src="https://www.krakend.io/images/logo-inverse.png" alt="KrakenD logo" height="35">
        </a>
        
        <nav class="navbar navbar-static-top" role="navigation">
            

            <button type="button" class="navbar-toggle collapsed pull-left" data-toggle="collapse" data-target="#navbar-collapse">
                <i class="fa fa-bars"></i>
            </button>

            <div class="navbar-collapse pull-left collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="https://www.krakend.io/features">Features</a>
                    </li>
                    <li>
                        <a href="https://www.krakend.io/download/">Download</a>
                    </li>
                    <li><a href="https://www.krakend.io/docs/overview/introduction">Documentation</a></li>

                    
                    <li><a href="https://www.krakend.io/blog">Blog</a></li>
                    <li><a href="https://www.krakend.io/support">Support</a></li>
                </ul>
                
            </div>

            
            <div class="navbar-custom-menu">

                <ul class="nav navbar-nav">
                    <li class="github-container">
                        <a class="github-button" href="https://github.com/devopsfaith/krakend" data-icon="octicon-star" data-show-count="true" aria-label="Star devopsfaith/krakend on GitHub">Star</a>
                    </li>
                    <li>
                        <a href="http://designer.krakend.io/">Go to KrakenDesigner</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>
        <aside class="main-sidebar">
            <section class="sidebar">
                
                <ul class="sidebar-menu">
    <li class="header">Documentation</li>
    
    
    
        
        <li class="treeview">
            <a href="javascript:;">
                <i class='fa fa-road'></i> <span>Getting Started</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu">
            
                <li class="">
                    <a href="/docs/overview/introduction/"><i class="fa fa-circle-o"></i> Introduction</a>
                </li>
            
                <li class="">
                    <a href="/docs/overview/installing/"><i class="fa fa-circle-o"></i> Installing KrakenD</a>
                </li>
            
                <li class="">
                    <a href="/docs/overview/usage/"><i class="fa fa-circle-o"></i> Using KrakenD</a>
                </li>
            
                <li class="">
                    <a href="/docs/overview/configuration/"><i class="fa fa-circle-o"></i> Configuration file</a>
                </li>
            
                <li class="">
                    <a href="/docs/overview/krakend-vs-krakend-ce/"><i class="fa fa-circle-o"></i> KrakenD vs KrakenD-CE</a>
                </li>
            
                <li class="">
                    <a href="/docs/overview/playground/"><i class="fa fa-circle-o"></i> The Playground</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview active">
            <a href="javascript:;">
                <i class='fa fa-check'></i> <span>Endpoints Features</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu menu-open">
            
                <li class="active">
                    <a href="/docs/features/response-manipulation/"><i class="fa fa-circle-o"></i> Response manipulation</a>
                </li>
            
                <li class="">
                    <a href="/docs/features/concurrent-requests/"><i class="fa fa-circle-o"></i> Concurrent Requests</a>
                </li>
            
                <li class="">
                    <a href="/docs/features/parameter-forwarding/"><i class="fa fa-circle-o"></i> Parameter forwarding</a>
                </li>
            
                <li class="">
                    <a href="/docs/features/security/"><i class="fa fa-circle-o"></i> Security</a>
                </li>
            
                <li class="">
                    <a href="/docs/features/content-types/"><i class="fa fa-circle-o"></i> Content Types</a>
                </li>
            
                <li class="">
                    <a href="/docs/features/other/"><i class="fa fa-circle-o"></i> Other</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview">
            <a href="javascript:;">
                <i class='fa fa-heartbeat'></i> <span>Throttling and Limits</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu">
            
                <li class="">
                    <a href="/docs/throttling/overview/"><i class="fa fa-circle-o"></i> Throttling Overview</a>
                </li>
            
                <li class="">
                    <a href="/docs/throttling/circuit-breaker/"><i class="fa fa-circle-o"></i> Circuit Breaker</a>
                </li>
            
                <li class="">
                    <a href="/docs/throttling/rate-limit/"><i class="fa fa-circle-o"></i> Rate Limits</a>
                </li>
            
                <li class="">
                    <a href="/docs/throttling/timeouts/"><i class="fa fa-circle-o"></i> Timeouts</a>
                </li>
            
                <li class="">
                    <a href="/docs/throttling/max-idle-connections/"><i class="fa fa-circle-o"></i> Max IDLE connections</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview">
            <a href="javascript:;">
                <i class='fa fa-space-shuttle'></i> <span>Command line commands</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu">
            
                <li class="">
                    <a href="/docs/commands/run/"><i class="fa fa-circle-o"></i> Run</a>
                </li>
            
                <li class="">
                    <a href="/docs/commands/check/"><i class="fa fa-circle-o"></i> Check</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview">
            <a href="javascript:;">
                <i class='fa fa-bar-chart'></i> <span>Benchmarks</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu">
            
                <li class="">
                    <a href="/docs/benchmarks/overview/"><i class="fa fa-circle-o"></i> Benchmarks Overview</a>
                </li>
            
                <li class="">
                    <a href="/docs/benchmarks/api-gateway-benchmark/"><i class="fa fa-circle-o"></i> KrakenD vs others</a>
                </li>
            
                <li class="">
                    <a href="/docs/benchmarks/aws/"><i class="fa fa-circle-o"></i> On Amazon Web Services</a>
                </li>
            
                <li class="">
                    <a href="/docs/benchmarks/local/"><i class="fa fa-circle-o"></i> Local machine</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview">
            <a href="javascript:;">
                <i class='fa fa-connectdevelop'></i> <span>Cluster</span>
                <span class="pull-right-container">
                    <i class="fa fa-angle-left pull-right"></i>
                </span>
            </a>
            <ul class="treeview-menu">
            
                <li class="">
                    <a href="/docs/cluster/cluster-overview/"><i class="fa fa-circle-o"></i> Overview</a>
                </li>
            
                <li class="">
                    <a href="/docs/cluster/configuration/"><i class="fa fa-circle-o"></i> Cluster configuration</a>
                </li>
            
                <li class="">
                    <a href="/docs/cluster/subscription-levels/"><i class="fa fa-circle-o"></i> Subscription levels</a>
                </li>
            
            </ul>
        </li>
        
    
        
        <li class="treeview">
            <a href="/docs/faq/">
                <i class='fa fa-wrench'></i>  <span>Troubleshooting</span>
            </a>
        </li>
        
    
        
        <li class="treeview">
            <a href="http://github.com/devopsfaith/krakend-ce/issues">
                <i class='fa fa-github'></i>  <span>Issues</span>
            </a>
        </li>
        
    
</ul>
                
            </section>
        </aside>

        <div class="content-wrapper">
            <section class="content-header">
                
<a class="btn btn-default pull-right"
href="https://github.com/devopsfaith/krakend-documentation/tree/master/features/response-manipulation.md">
    <span><i class="fa fa-edit"></i> Edit this page</span>
</a>
<h1>
    Response manipulation
</h1>

            </section>
            <section class="content">
                
<div class="row">
    <section class="col-md-12 docs">

        <div class="box box-primary">
            <div class="box-body">
                
                
                <div class="pull-right col-md-4 visible-lg-inline TOC">
                    <div class="box">
                    <div class="box-header with-border">
                        <h5 class="box-title"><i class="fa fa-book"></i> Table of Contents</h5>
                        <div class="pull-right">
                            <a data-widget="collapse"><i class="fa fa-minus"></i></a>
                        </div>
                    </div>

                        <div class="box-body">
                            <nav id="TableOfContents">
<ul>
<li><a href="#merging">Merging</a>
<ul>
<li><a href="#merging-timeouts">Merging timeouts</a>
<ul>
<li><a href="#what-happens-when-the-timeout-is-triggered">What happens when the timeout is triggered?</a></li>
</ul></li>
<li><a href="#merge-example">Merge example</a></li>
</ul></li>
<li><a href="#filtering">Filtering</a>
<ul>
<li><a href="#blacklisting-fields-don-t-show">Blacklisting fields (don&rsquo;t show)</a>
<ul>
<li><a href="#blacklist-example">Blacklist example</a></li>
</ul></li>
<li><a href="#whitelisting-fields-only-show">Whitelisting fields (only show)</a></li>
<li><a href="#whitelist-or-blacklist">Whitelist or blacklist</a></li>
</ul></li>
<li><a href="#grouping">Grouping</a>
<ul>
<li><a href="#grouping-example">Grouping example</a></li>
</ul></li>
<li><a href="#mapping-renaming">Mapping (renaming)</a>
<ul>
<li><a href="#mapping-example">Mapping example:</a></li>
</ul></li>
<li><a href="#capturing">Capturing</a>
<ul>
<li><a href="#capturing-example">Capturing example</a></li>
</ul></li>
</ul>
</nav>
                        </div>
                    </div>
                </div>
                

                

<p>KrakenD allows you to perform several manipulations of the responses out of the box, just by adding them in the configuration file. You can also add your own or 3rd parties middlewares to extend this behavior.</p>

<p>KrakenD manipulations are measured in <code>nanoseconds</code>, you can find the benchmark for every response manipulation in the <a href="https://github.com/devopsfaith/krakend/blob/master/docs/BENCHMARKS.md#response-manipulation">benchmarks</a></p>

<p>The following manipulations are available by default:</p>

<h1 id="merging">Merging</h1>

<p>When you create KrakenD endpoints, if a specific endpoint feeds from 2 or more backend sources (APIs), they will be automatically merged in a single response to the client. For instance, imagine you have 3 different API services exposing the resources <code>/a</code>,<code>/b</code> and <code>/c</code> and you want to expose them all together in the KrakenD endpoint <code>/abc</code>. This is what you would get:</p>

<p><img class="img-responsive" src="/images/documentation/krakend-merge.png" /></p>

<p>The merge operation is implemented in a way where user experience and responsiveness goes first. It does its <em>best effort</em> to get all the required parts from the involved backends and returning the composed object as soon as possible.</p>

<p>The configuration for the image above could be like this:</p>

<pre><code>&quot;endpoints&quot;: [
    {
      &quot;endpoint&quot;: &quot;/abc&quot;,
      &quot;timeout&quot;: &quot;800ms&quot;,
      &quot;method&quot;: &quot;GET&quot;,
      &quot;backend&quot;: [
        {
          &quot;url_pattern&quot;: &quot;/a&quot;,
          &quot;encoding&quot;: &quot;json&quot;,
          &quot;host&quot;: [
            &quot;http://service-a.company.com&quot;
          ]
        },
        {
          &quot;url_pattern&quot;: &quot;/b&quot;,
          &quot;encoding&quot;: &quot;xml&quot;,
          &quot;host&quot;: [
            &quot;http://service-b.company.com&quot;
          ]
        },
        {
          &quot;url_pattern&quot;: &quot;/c&quot;,
          &quot;encoding&quot;: &quot;json&quot;,
          &quot;host&quot;: [
            &quot;http://service-c.company.com&quot;
          ]
        }
      ]
    }
</code></pre>

<h2 id="merging-timeouts">Merging timeouts</h2>

<p>Keep in mind that in order to avoid any degraded user experience, KrakenD won&rsquo;t be stuck forever until all the backends decide to respond. In a gateway <strong>failing fast is better than succeeding slowly</strong> and KrakenD will make sure this happens as it will <strong>apply the timeout policy</strong>. This will put your users safe during high load peaks, network errors, or any other problems that stress your backends.</p>

<p>The <code>timeout</code> value can be introduced inside each endpoint or globally placing <code>timeout</code> in the root of the configuration file. The most specific definition always overwrites the generic one.</p>

<h3 id="what-happens-when-the-timeout-is-triggered">What happens when the timeout is triggered?</h3>

<p>If KrakenD is waiting for the backends to respond and the timeout is reached, the response will be incomplete and missing any data that couldn&rsquo;t be fetched before the timeout happened. On the other hand, all the parts that could effectively be retrieved before the timeout happened they will do appear in the response.</p>

<p>In the case the response has missing parts the <strong>cache header won&rsquo;t exist</strong>, as we don&rsquo;t want clients to cache incomplete responses</p>

<h2 id="merge-example">Merge example</h2>

<p>Imagine an endpoint with the following configuration:</p>

<pre><code>...
&quot;endpoints&quot;: [
    {
      &quot;endpoint&quot;: &quot;/users/{user}&quot;,
      &quot;method&quot;: &quot;GET&quot;,
      &quot;timeout&quot;: &quot;800ms&quot;
      &quot;backend&quot;: [
        {
          &quot;url_pattern&quot;: &quot;/users/{user}&quot;,
          &quot;host&quot;: [
            &quot;https://jsonplaceholder.typicode.com&quot;
          ]
        },
        {
          &quot;url_pattern&quot;: &quot;/posts/{user}&quot;,
          &quot;host&quot;: [
            &quot;https://jsonplaceholder.typicode.com&quot;
          ]
        }
      ]
    }
</code></pre>

<p>When a user calls the endpoint <code>/users/1</code>, KrakenD will send two requests and, in the happy scenario, it will receive these responses:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Leanne Graham&quot;,
  &quot;username&quot;: &quot;Bret&quot;,
  &quot;email&quot;: &quot;Sincere@april.biz&quot;,
  &quot;address&quot;: {
    &quot;street&quot;: &quot;Kulas Light&quot;,
    &quot;suite&quot;: &quot;Apt. 556&quot;,
    &quot;city&quot;: &quot;Gwenborough&quot;,
    &quot;zipcode&quot;: &quot;92998-3874&quot;,
    &quot;geo&quot;: {
      &quot;lat&quot;: &quot;-37.3159&quot;,
      &quot;lng&quot;: &quot;81.1496&quot;
    }
  },
  &quot;phone&quot;: &quot;1-770-736-8031 x56442&quot;,
  &quot;website&quot;: &quot;hildegard.org&quot;,
  &quot;company&quot;: {
    &quot;name&quot;: &quot;Romaguera-Crona&quot;,
    &quot;catchPhrase&quot;: &quot;Multi-layered client-server neural-net&quot;,
    &quot;bs&quot;: &quot;harness real-time e-markets&quot;
  }
}
</code></pre>

<p>and</p>

<pre><code>{
  &quot;userId&quot;: 1,
  &quot;id&quot;: 1,
  &quot;title&quot;: &quot;sunt aut facere repellat provident occaecati excepturi optio reprehenderit&quot;,
  &quot;body&quot;: &quot;quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto&quot;
}
</code></pre>

<p>With these &lsquo;partial responses&rsquo; and the given configuration, KrakenD will return the following response:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Leanne Graham&quot;,
  &quot;username&quot;: &quot;Bret&quot;,
  &quot;email&quot;: &quot;Sincere@april.biz&quot;,
  &quot;address&quot;: {
    &quot;street&quot;: &quot;Kulas Light&quot;,
    &quot;suite&quot;: &quot;Apt. 556&quot;,
    &quot;city&quot;: &quot;Gwenborough&quot;,
    &quot;zipcode&quot;: &quot;92998-3874&quot;,
    &quot;geo&quot;: {
      &quot;lat&quot;: &quot;-37.3159&quot;,
      &quot;lng&quot;: &quot;81.1496&quot;
    }
  },
  &quot;phone&quot;: &quot;1-770-736-8031 x56442&quot;,
  &quot;website&quot;: &quot;hildegard.org&quot;,
  &quot;company&quot;: {
    &quot;name&quot;: &quot;Romaguera-Crona&quot;,
    &quot;catchPhrase&quot;: &quot;Multi-layered client-server neural-net&quot;,
    &quot;bs&quot;: &quot;harness real-time e-markets&quot;
  },
  &quot;userId&quot;: 1,
  &quot;title&quot;: &quot;sunt aut facere repellat provident occaecati excepturi optio reprehenderit&quot;,
  &quot;body&quot;: &quot;quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto&quot;
}
</code></pre>

<h1 id="filtering">Filtering</h1>

<p>When you create a KrakenD endpoint you can decide to show only a subset of the fields coming from the response of your backends. There are a number of different reasons you might want to use this functionality, but we strongly encourage you to use it to save user&rsquo;s bandwith and increase load and render times.</p>

<p>There are two different strategies you can use to filter content:</p>

<ul>
<li>Blacklist</li>
<li>Whitelist</li>
</ul>

<h2 id="blacklisting-fields-don-t-show">Blacklisting fields (don&rsquo;t show)</h2>

<p>The blacklist filter can be read as the <em>don&rsquo;t show this</em> filter. KrakenD will remove from the response all matching fields defined in the list, and the ones that do not match will be revealed. Use the blacklist to exclude some fields in the response.</p>

<p>The blacklisted fields of your choice can also be nested field. Use a <strong>dot</strong> as the level separator. For instance the <code>a1</code> field in the following JSON response <code>{ &quot;a&quot;: { &quot;a1&quot;: 1 } }</code> can be blacklisted as <code>a.a1</code>.</p>

<h3 id="blacklist-example">Blacklist example</h3>

<p>We will use the <a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a> fake API so you can see live the output of the backend.</p>

<p>We want to setup a KrakenD endpoint that returns the <strong>posts for a specific user</strong>, but we&rsquo;ve seen that the <a href="(https://jsonplaceholder.typicode.com/posts/1)">backend response</a> contains too much data since our use case do not need the <code>body</code> and <code>userId</code> fields and we want a lighter and faster response.</p>

<p>The KrakenD endpoint to accept URLs like<code>/posts/1</code> is defined as follows:</p>

<pre><code>{
  &quot;endpoint&quot;: &quot;/posts/{user}&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;backend&quot;: [
    {
      &quot;url_pattern&quot;: &quot;/posts/{user}&quot;,
      &quot;host&quot;: [
        &quot;https://jsonplaceholder.typicode.com&quot;
      ],
      &quot;blacklist&quot;: [
        &quot;body&quot;,
        &quot;userId&quot;
      ]
    }
  ]
}
</code></pre>

<p>Now, when calling the KrakenD endpoint <code>/posts/1</code> the response you would get will be as follows:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;title&quot;: &quot;sunt aut facere repellat provident occaecati excepturi optio reprehenderit&quot;
}
</code></pre>

<p><a href="https://jsonplaceholder.typicode.com/posts/1">Compared with the backend response</a> you&rsquo;ll see that the fields <code>body</code> and <code>userId</code> are not longer there.</p>

<h2 id="whitelisting-fields-only-show">Whitelisting fields (only show)</h2>

<p>The blacklist filter can be read as the <em>only show this</em> filter. When you set a whitelist KrakenD will include in the endpoint response only those fields that match exactly with your choice. Use the whitelist to strictly define the fields you want to show in the response.</p>

<p>The whitelisted fields of your choice can also be nested field. Use a <strong>dot</strong> as the level separator. For instance the <code>a1</code> field in the following JSON response <code>{ &quot;a&quot;: { &quot;a1&quot;: 1 } }</code> can be whitelisted as <code>a.a1</code>.</p>

<p>###Â Whitelist example
We will repeat the same exercise we did in the blacklist to get the same output. We only want to get the <code>id</code> and <code>title</code> fields from the backend.</p>

<pre><code>{
  &quot;endpoint&quot;: &quot;/posts/{user}&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;backend&quot;: [
    {
      &quot;url_pattern&quot;: &quot;/posts/{user}&quot;,
      &quot;host&quot;: [
        &quot;https://jsonplaceholder.typicode.com&quot;
      ],
      &quot;whitelist&quot;: [
        &quot;id&quot;,
        &quot;title&quot;
      ]
    }
  ]
}
</code></pre>

<p>Now, when calling the KrakenD endpoint <code>/posts/1</code> the response you would get will be as follows:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;title&quot;: &quot;sunt aut facere repellat provident occaecati excepturi optio reprehenderit&quot;
}
</code></pre>

<p>Just exactly as we did with the blacklist.</p>

<h2 id="whitelist-or-blacklist">Whitelist or blacklist</h2>

<p>When filtering you need to choose the blacklist or the whitelist, as the behaviors are contradictory and can&rsquo;t coexist. Nothing stops you to play for a while and see what happens if you mix them, but you&rsquo;ve been warned!</p>

<h1 id="grouping">Grouping</h1>

<p>KrakenD is able to group partial responses from backends under a user-defined field. In other words, when you set the <code>group</code> attribute for a backend, instead of placing all the response attributes in the root, KrakenD will create a new key and place the response inside.</p>

<p>Grouping is useful to encapsulate every backend call under different keys, especially when different backend responses can have colliding key names (e.g: all responses contain an <code>id</code> with different values).</p>

<h2 id="grouping-example">Grouping example</h2>

<p>The following code is an endpoint that gets data from two different backends but one of the responses is encapsulated inside the field <code>last_post</code>.</p>

<pre><code>{
  &quot;endpoint&quot;: &quot;/users/{user}&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;backend&quot;: [
    {
      &quot;url_pattern&quot;: &quot;/users/{user}&quot;,
      &quot;host&quot;: [
        &quot;https://jsonplaceholder.typicode.com&quot;
      ]
    },
    {
      &quot;url_pattern&quot;: &quot;/posts/{user}&quot;,
      &quot;host&quot;: [
        &quot;https://jsonplaceholder.typicode.com&quot;
      ],
      &quot;group&quot;: &quot;last_post&quot;
    }
  ]
}
</code></pre>

<p>This will generate responses like this one:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Leanne Graham&quot;,
  &quot;username&quot;: &quot;Bret&quot;,
  &quot;email&quot;: &quot;Sincere@april.biz&quot;,
  &quot;address&quot;: {
    &quot;street&quot;: &quot;Kulas Light&quot;,
    &quot;suite&quot;: &quot;Apt. 556&quot;,
    &quot;city&quot;: &quot;Gwenborough&quot;,
    &quot;zipcode&quot;: &quot;92998-3874&quot;,
    &quot;geo&quot;: {
      &quot;lat&quot;: &quot;-37.3159&quot;,
      &quot;lng&quot;: &quot;81.1496&quot;
    }
  },
  &quot;phone&quot;: &quot;1-770-736-8031 x56442&quot;,
  &quot;website&quot;: &quot;hildegard.org&quot;,
  &quot;company&quot;: {
    &quot;name&quot;: &quot;Romaguera-Crona&quot;,
    &quot;catchPhrase&quot;: &quot;Multi-layered client-server neural-net&quot;,
    &quot;bs&quot;: &quot;harness real-time e-markets&quot;
  },
  &quot;last_post&quot;: {
    &quot;id&quot;: 1,
    &quot;userId&quot;: 1,
    &quot;title&quot;: &quot;sunt aut facere repellat provident occaecati excepturi optio reprehenderit&quot;,
    &quot;body&quot;: &quot;quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto&quot;
  }
}
</code></pre>

<h1 id="mapping-renaming">Mapping (renaming)</h1>

<p>KrakenD is also able to manipulate the name of the fields of the generated responses, so your composed response would be as close to your use case as possible without changing a line on any backend.</p>

<p>In the <code>mapping</code> section map the original field name with the desired name.</p>

<h2 id="mapping-example">Mapping example:</h2>

<p>Instead of showing the <code>email</code> field we want to name it <code>personal_email</code>:</p>

<pre><code>{
  &quot;endpoint&quot;: &quot;/users/{user}&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;backend&quot;: [
    {
      &quot;url_pattern&quot;: &quot;/users/{user}&quot;,
      &quot;host&quot;: [
        &quot;https://jsonplaceholder.typicode.com&quot;
      ],
      &quot;mapping&quot;: {
        &quot;email&quot;: &quot;personal_email&quot;
      }
    }
  ]
}
</code></pre>

<p>Will generate responses like this one:</p>

<pre><code>{
  &quot;id&quot;: 1,
  &quot;name&quot;: &quot;Leanne Graham&quot;,
  &quot;username&quot;: &quot;Bret&quot;,
  &quot;personal_email&quot;: &quot;Sincere@april.biz&quot;,
  &quot;address&quot;: {
    &quot;street&quot;: &quot;Kulas Light&quot;,
    &quot;suite&quot;: &quot;Apt. 556&quot;,
    &quot;city&quot;: &quot;Gwenborough&quot;,
    &quot;zipcode&quot;: &quot;92998-3874&quot;,
    &quot;geo&quot;: {
      &quot;lat&quot;: &quot;-37.3159&quot;,
      &quot;lng&quot;: &quot;81.1496&quot;
    }
  },
  &quot;phone&quot;: &quot;1-770-736-8031 x56442&quot;,
  &quot;website&quot;: &quot;hildegard.org&quot;,
  &quot;company&quot;: {
    &quot;name&quot;: &quot;Romaguera-Crona&quot;,
    &quot;catchPhrase&quot;: &quot;Multi-layered client-server neural-net&quot;,
    &quot;bs&quot;: &quot;harness real-time e-markets&quot;
  }
}
</code></pre>

<h1 id="capturing">Capturing</h1>

<p>It is frequent in many API implementations that the desired data is always encapsulated inside a generic field like <code>data</code> or <code>content</code> and you don&rsquo;t want to have this level in your responses.</p>

<p>Use capturing when you want to capture the content inside these generic containers and extract it to the root as it never existed and when you want to work with other manipulation options. Capture takes place before other options like whitelist or mapping.</p>

<p>The capturing option uses the attribute <code>target</code> in the configuration file.</p>

<h2 id="capturing-example">Capturing example</h2>

<p>Given a backend endpoint with this kind of responses containing a level <code>data</code>:</p>

<pre><code>{
  &quot;apiVersion&quot;:&quot;2.0&quot;,
  &quot;data&quot;: {
    &quot;updated&quot;:&quot;2010-01-07T19:58:42.949Z&quot;,
    &quot;totalItems&quot;:800,
    &quot;startIndex&quot;:1,
    &quot;itemsPerPage&quot;:1,
    &quot;items&quot;:[]
  }
}
</code></pre>

<p>and with this KrakenD configuration</p>

<pre><code>{
  &quot;endpoint&quot;: &quot;/foo&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;backend&quot;: [
    {
      &quot;url_pattern&quot;: &quot;/bar&quot;,
      &quot;target&quot;: &quot;data&quot;
    }
  ]
}
</code></pre>

<p>the gateway will generate responses like this one:</p>

<pre><code>{
    &quot;updated&quot;:&quot;2010-01-07T19:58:42.949Z&quot;,
    &quot;totalItems&quot;:800,
    &quot;startIndex&quot;:1,
    &quot;itemsPerPage&quot;:1,
    &quot;items&quot;:[]
}
</code></pre>


                <div class="col-md-12">
                    <hr/>
                    <p class="pull-right">
                        <a class="btn btn-primary btn-circle" href="/support">Need support?</a>
                    </p>
                </div>
            </div>
    </section>
</div>

            </section>
        </div>
    </div>
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5">
                <img src="/images/logo-inverse.png" >
                <p class="lead">The <strong>Ultra-High performance</strong> API Gateway with middlewares</p>
                <span>KrakenD helps application developers release features quickly by eliminating all the complexities of SOA architectures, while offering a unique performance.</span>
                <div class="social">
                    <a href="https://www.facebook.com/apigateway" target="_blank"  title="Facebook">
                        <i class="fa fa-facebook-official" aria-hidden="true"></i><span class="sr-only">Facebook</span>
                    </a>
                    <a href="https://twitter.com/devopsfaith" target="_blank" class="social-btn-twitter" title="Twitter">
                        <i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">Twitter</span>
                    </a>
                    <a href="https://github.com/devopsfaith" target="_blank" class="social-btn-github" title="GitHub">
                        <i class="fa fa-github" aria-hidden="true"></i><span class="sr-only">GitHub</span>
                    </a>
                    <a href="mailto:hello@krakend.io" target="_blank" title="Send us an email">
                        <i class="fa fa-envelope" aria-hidden="true"></i><span class="sr-only">Mail</span>
                    </a>
                </div>

            </div>
            <nav>
                <div class="col-md-2 col-md-offset-1">
                    <h6>Devops Faith</h6>
                    <ul class="list-unstyled">
                        
                        <li><a href="http://devops.faith">Devops Faith</a></li>
                        <li><a href="https://medium.com/devops-faith">Blog</a></li>
                        <li><a href="mailto:hello@krakend.io">Contact Us</a></li>
                    </ul>
                    <h6>More products</h6>
                    <ul class="list-unstyled">
                        <li><a href="http://api2html.com">API2HTML</a></li>
                    </ul>

                </div>
                <div class="col-md-2">
                    <h6>Product</h6>
                    <ul class="list-unstyled">
                        <li><a href="https://www.krakend.io/features/">Features</a></li>
                        <li><a href="https://www.krakend.io/docs/benchmarks/overview/">Benchmarks</a></li>
                        <li><a href="https://www.krakend.io/download/">Download</a></li>
                        <li><a href="https://www.krakend.io/blog/">KrakenD Blog</a></li>

                    </ul>

                </div>
                <div class="col-md-2">
                    <h6>Support</h6>
                    <ul class="list-unstyled">
                        <li><a href="https://www.krakend.io/docs/overview/introduction">Documentation</a></li>
                        <li><a href="https://github.com/devopsfaith/krakend" target="_blank">Open Source</a></li>
                        <li><a href="https://github.com/devopsfaith/krakend/issues">Report a problem</a></li>
                        <li><a href="https://www.krakend.io/support/">Support</a></li>
                        

                    </ul>
                </div>
            </nav>
        </div>
        <div class="row">
            <div class="col-md-5 additional-links">
                <strong>Copyright &copy; 2017-2018 <a href="http://devops.faith">Devops Faith</a>.</strong> All rights reserved.
            </div>
            <div class="pull-right hidden-xs">
                Made with <i class="fa fa-heart-o" style="color:hotpink"></i> in Barcelona by <a href="https://twitter.com/devopsfaith">
                    <img height="30px" src="/images/devops-faith-logo-inverse.png" />
                </a>


            </div>
        </div>
    </div>
</footer>

    
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-87994359-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    <script src="https://www.krakend.io/dist/js/jquery-2.2.3.min.js"></script>
<script src="https://www.krakend.io/dist/js/bootstrap.min.js"></script>
<script src="https://www.krakend.io/dist/js/app.min.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
    
</body>
</html>